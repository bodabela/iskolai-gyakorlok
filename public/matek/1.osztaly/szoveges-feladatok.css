body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        .controls-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 900px;
        }

        .settings-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px 20px; /* Vertical and horizontal gap */
            width:100%;
        }
        .settings-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
        }

        .control-label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.95em;
            transition: color 0.5s ease;
        }

        .theme-button, .mode-button {
            padding: 8px 12px;
            border: 1px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, transform 0.2s ease;
        }
        .theme-button:hover, .mode-button:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }
        .theme-button.active, .mode-button.active {
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2), 0 0 0 2px var(--theme-button-active-border-color, #000);
            transform: translateY(1px);
        }

        .container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 900px;
            text-align: center;
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }

        h1, h2 {
            text-align: center;
            transition: color 0.5s ease;
        }
        h1 {
            font-size: clamp(1.8em, 5vw, 2.2em);
            margin-bottom: 15px;
        }
        h2 {
            font-size: clamp(1.3em, 4vw, 1.6em);
            margin-bottom: 25px;
        }
        .task {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            transition: background-color 0.5s ease, border-color 0.5s ease;
            border: 1px solid transparent; 
        }
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .task-header h3 {
            margin-top: 0;
            margin-bottom: 0;
            font-size: clamp(1.1em, 3.5vw, 1.3em);
            transition: color 0.5s ease;
        }
        .new-task-button {
            padding: 6px 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .task p.instructions, .word-problem-text {
            line-height: 1.6;
            font-size: clamp(1em, 3vw, 1.1em);
            margin-bottom: 15px;
            transition: color 0.5s ease;
            text-align: left;
        }
        .word-problem-text {
            padding: 10px;
            border-radius: 6px;
            margin-bottom:20px;
        }

        .step-container {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            transition: background-color 0.3s ease, opacity 0.3s ease;
            border: 1px solid var(--task-border, #e5e7eb);
        }
        .step-container.solved {
            opacity: 0.7; 
        }
        .step-container.solved input, .step-container.solved select {
            background-color: var(--task-bg, #f9fafb); 
        }

        .step-container h4 {
            font-size: clamp(1.05em, 3.2vw, 1.2em);
            font-weight: bold;
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 1px solid;
            padding-bottom: 5px;
            transition: color 0.5s ease, border-color 0.5s ease;
        }
        .step-container .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        .step-container label {
            font-weight: normal;
            font-size: clamp(0.95em, 2.9vw, 1.05em);
            margin-right: 5px;
            transition: color 0.5s ease;
        }
        .step-container input[type="text"],
        .step-container input[type="number"],
        .step-container select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: clamp(0.9em, 2.8vw, 1em);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
         .step-container input[type="number"] {
            width: 60px;
            text-align: center;
        }
        .step-container input[type="text"] {
            flex-grow: 1;
            min-width: 100px;
        }
        .step-container select {
            min-width: 50px;
        }
      
        .visual-aid-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 130px; 
            margin: 15px auto; 
            border-radius: 6px;
            padding:5px; 
            transition: background-color 0.3s ease;
            max-width: 320px; 
        }
        .visual-aid-container svg {
            max-width: 100%;
            max-height: 120px; 
        }
      
        input.correct-input {
            border: 2px solid var(--feedback-correct-border-color, green) !important;
            box-shadow: 0 0 5px var(--feedback-correct-border-color, green);
        }
        input.incorrect-input {
            border: 2px solid var(--feedback-incorrect-border-color, red) !important;
            box-shadow: 0 0 5px var(--feedback-incorrect-border-color, red);
        }

        button.task-button {
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(1em, 3vw, 1.1em);
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button.task-button:hover {
            transform: translateY(-2px);
        }
        button.task-button:active {
            transform: translateY(0px);
        }
        .feedback {
            margin-top: 15px;
            font-weight: bold;
            padding: 10px;
            border-radius: 6px;
            font-size: clamp(0.9em, 2.8vw, 1.05em);
            transition: color 0.5s ease, background-color 0.5s ease, border-color 0.5s ease;
            min-height: 1.5em;
            line-height: 1.4;
        }

        :root {
            --body-bg-start: #e0f2fe; 
            --body-bg-end: #f3e8ff;   
            --container-bg: #ffffff;
            --text-color: #333333;
            --h1-color: #3b82f6; 
            --h2-color: #6366f1; 
            --task-bg: #f9fafb; 
            --task-border: #e5e7eb; 
            --task-header-color: #1f2937; 
            --task-instruction-color: #4b5563; 
            --button-bg: #3b82f6; 
            --button-hover-bg: #2563eb; 
            --theme-button-active-border-color: #60a5fa; 
            --feedback-correct-text-color: #166534;
            --feedback-correct-bg-color: #dcfce7;
            --feedback-correct-border-color: #4ade80;
            --feedback-incorrect-text-color: #991b1b;
            --feedback-incorrect-bg-color: #fee2e2;
            --feedback-incorrect-border-color: #f87171;
            --step-container-bg: rgba(255,255,255,0.7); 
            --step-container-header-border: rgba(0,0,0,0.1);
            --word-problem-text-bg: rgba(0,0,0,0.03);
            --visual-aid-bg: rgba(0,0,0,0.01);
        }
        body.theme-candy {
            --body-bg-start: #ffebf0; --body-bg-end: #ffe4e1; --container-bg: #fff0f5; --text-color: #5c3c4c; --h1-color: #ff69b4; --h2-color: #ff1493; --task-bg: #fffafa; --task-border: #ffb6c1; --task-header-color: #c71585; --task-instruction-color: #db7093; --button-bg: #ff69b4; --button-hover-bg: #ff1493; --theme-button-active-border-color: #ff85a2; --step-container-bg: rgba(255,240,245,0.8); --step-container-header-border: #ffb6c1; --word-problem-text-bg: rgba(255,230,235,0.6); --visual-aid-bg: rgba(255,240,245,0.4);
        }
        body.theme-space {
            --body-bg-start: #2c3e50; --body-bg-end: #34495e; --container-bg: #1f2c38; --text-color: #ecf0f1; --h1-color: #3498db; --h2-color: #2980b9; --task-bg: #2c3a47; --task-border: #5d6d7e; --task-header-color: #bdc3c7; --task-instruction-color: #95a5a6; --button-bg: #3498db; --button-hover-bg: #5dade2; --theme-button-active-border-color: #85c1e9; --step-container-bg: rgba(44,62,80,0.8); --step-container-header-border: #5d6d7e; --word-problem-text-bg: rgba(55,65,81,0.6); --visual-aid-bg: rgba(44,62,80,0.4);
        }
        body.theme-jungle {
            --body-bg-start: #38761d; --body-bg-end: #6aa84f; --container-bg: #2a531b; --text-color: #e8f5e9; --h1-color: #93c47d; --h2-color: #b6d7a8; --task-bg: #3a632cc7; --task-border: #799e6c; --task-header-color: #d9ead3; --task-instruction-color: #c9dfc0; --button-bg: #6aa84f; --button-hover-bg: #8fbc8f; --theme-button-active-border-color: #a9d18e; --step-container-bg: rgba(58,99,44,0.8); --step-container-header-border: #799e6c; --word-problem-text-bg: rgba(85,139,47,0.5); --visual-aid-bg: rgba(68,114,52,0.3);
        }
         body.theme-magicforest {
            --body-bg-start: #e6ffe6; --body-bg-end: #d4f0c4; --container-bg: #f0fff0; --text-color: #2e452a; --h1-color: #556b2f; --h2-color: #228b22; --task-bg: #f5fff5; --task-border: #90ee90; --task-header-color: #006400; --task-instruction-color: #3cb371; --button-bg: #2e8b57; --button-hover-bg: #3cb371; --theme-button-active-border-color: #66cdaa; --step-container-bg: rgba(221,255,221,0.8); --step-container-header-border: #dda0dd; --word-problem-text-bg: rgba(147,112,219,0.3); --visual-aid-bg: rgba(230,230,250,0.4);
        }
        body.theme-ocean {
            --body-bg-start: #e0ffff; --body-bg-end: #afeeee; --container-bg: #f0ffff; --text-color: #005050; --h1-color: #20b2aa; --h2-color: #008080; --task-bg: #f5fffa; --task-border: #7fffd4; --task-header-color: #008080; --task-instruction-color: #48d1cc; --button-bg: #20b2aa; --button-hover-bg: #40e0d0; --theme-button-active-border-color: #5f9ea0; --step-container-bg: rgba(224,255,255,0.8); --step-container-header-border: #7fffd4; --word-problem-text-bg: rgba(0,137,123,0.3); --visual-aid-bg: rgba(224,247,250,0.4);
        }
        body.theme-flowergarden {
            --body-bg-start: #fff8e1; --body-bg-end: #ffecb3; --container-bg: #fffaf0; --text-color: #6d4c41; --h1-color: #ff7043; --h2-color: #f4511e; --task-bg: #fffde7; --task-border: #ffd54f; --task-header-color: #e65100; --task-instruction-color: #ff8f00; --button-bg: #ff7043; --button-hover-bg: #ff8a65; --theme-button-active-border-color: #ffa726; --step-container-bg: rgba(255,250,224,0.8); --step-container-header-border: #ffd54f; --word-problem-text-bg: rgba(230,81,0,0.3); --visual-aid-bg: rgba(255,243,224,0.4);
        }
        body.theme-sky {
            --body-bg-start: #e1f5fe; --body-bg-end: #b3e5fc; --container-bg: #f0f9ff; --text-color: #01579b; --h1-color: #03a9f4; --h2-color: #0288d1; --task-bg: #e3f2fd; --task-border: #81d4fa; --task-header-color: #01579b; --task-instruction-color: #039be5; --button-bg: #03a9f4; --button-hover-bg: #29b6f6; --theme-button-active-border-color: #4fc3f7; --step-container-bg: rgba(225,245,254,0.8); --step-container-header-border: #81d4fa; --word-problem-text-bg: rgba(2,136,209,0.3); --visual-aid-bg: rgba(225,245,254,0.4);
        }
        body.theme-tech {
            --body-bg-start: #37474f; --body-bg-end: #546e7a; --container-bg: #263238; --text-color: #cfd8dc; --h1-color: #00bcd4; --h2-color: #00acc1; --task-bg: #303f46; --task-border: #546e7a; --task-header-color: #b0bec5; --task-instruction-color: #90a4ae; --button-bg: #00bcd4; --button-hover-bg: #26c6da; --theme-button-active-border-color: #4dd0e1; --step-container-bg: rgba(55,71,79,0.8); --step-container-header-border: #546e7a; --word-problem-text-bg: rgba(38,198,218,0.3); --visual-aid-bg: rgba(55,71,79,0.4);
        }
         body.theme-sport {
            --body-bg-start: #e3f2fd; --body-bg-end: #bbdefb; --container-bg: #f1f8e9; --text-color: #212121; --h1-color: #ff5722; --h2-color: #f44336; --task-bg: #fff; --task-border: #90caf9; --task-header-color: #0d47a1; --task-instruction-color: #1976d2; --button-bg: #4caf50; --button-hover-bg: #66bb6a; --theme-button-active-border-color: #81c784; --step-container-bg: rgba(227,242,253,0.8); --step-container-header-border: #90caf9; --word-problem-text-bg: rgba(25,118,210,0.3); --visual-aid-bg: rgba(227,242,253,0.4);
        }
        body.theme-adventure {
            --body-bg-start: #efebe9; --body-bg-end: #d7ccc8; --container-bg: #f5f5f5; --text-color: #3e2723; --h1-color: #8d6e63; --h2-color: #795548; --task-bg: #fafafa; --task-border: #a1887f; --task-header-color: #4e342e; --task-instruction-color: #6d4c41; --button-bg: #795548; --button-hover-bg: #8d6e63; --theme-button-active-border-color: #a1887f; --step-container-bg: rgba(239,235,233,0.8); --step-container-header-border: #a1887f; --word-problem-text-bg: rgba(93,64,55,0.3); --visual-aid-bg: rgba(239,235,233,0.4);
        }

        .theme-button { background-color: var(--task-bg); color: var(--task-header-color); border: 1px solid var(--task-border); }
        .theme-button:hover { opacity: 1; background-color: var(--task-border); }
        .theme-button.active { background-color: var(--button-bg); color: white; border-color: var(--button-bg); box-shadow: inset 0 1px 3px rgba(0,0,0,0.2), 0 0 0 2px var(--theme-button-active-border-color); }
        button.task-button, button.new-task-button { background-color: var(--button-bg); color: white; }
        button.task-button:hover, button.new-task-button:hover { background-color: var(--button-hover-bg); }
        .feedback.correct { color: var(--feedback-correct-text-color, #166534); background-color: var(--feedback-correct-bg-color, #dcfce7); border: 1px solid var(--feedback-correct-border-color, #4ade80); }
        .feedback.incorrect { color: var(--feedback-incorrect-text-color, #991b1b); background-color: var(--feedback-incorrect-bg-color, #fee2e2); border: 1px solid var(--feedback-incorrect-border-color, #f87171); }
        .word-problem-text { background-color: var(--word-problem-text-bg); }
        .visual-aid-container { background-color: var(--visual-aid-bg); }
        .step-container { background-color: var(--step-container-bg); border-color: var(--task-border); }
        .step-container h4 { border-bottom-color: var(--step-container-header-border); color: var(--task-header-color); }
        .step-container label { color: var(--task-instruction-color); }
        .step-container input, .step-container select { border-color: var(--task-border); background-color: var(--container-bg); color: var(--text-color); }
        .step-container input:focus, .step-container select:focus { border-color: var(--button-bg); box-shadow: 0 0 0 2px var(--theme-button-active-border-color); outline: none; }
        .step-container input:disabled, .step-container select:disabled {
            background-color: var(--task-bg) !important; 
            color: var(--task-instruction-color) !important;
            opacity: 0.7;
            cursor: default;
        }
        #displayed_operation_text { /* Már a renderStep-ben kap stílust ID alapján */ }
        #displayed_text_answer_content { /* Már a renderStep-ben kap stílust ID alapján */ }